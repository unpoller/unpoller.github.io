"use strict";(self.webpackChunkpollerdox=self.webpackChunkpollerdox||[]).push([[674],{8453:(e,n,o)=>{o.d(n,{R:()=>l,x:()=>a});var r=o(6540);const s={},i=r.createContext(s);function l(e){const n=r.useContext(i);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:l(e.components),r.createElement(i.Provider,{value:n},e.children)}},8728:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>t,contentTitle:()=>a,default:()=>h,frontMatter:()=>l,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"install/dockercompose","title":"Docker Compose","description":"This page assumes that you have decided to start Unpoller using docker-compose.","source":"@site/docs/install/dockercompose.md","sourceDirName":"install","slug":"/install/dockercompose","permalink":"/docs/install/dockercompose","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"id":"dockercompose","title":"Docker Compose"},"sidebar":"someSidebar","previous":{"title":"Unifi Controller Login","permalink":"/docs/install/controllerlogin"},"next":{"title":"Docker","permalink":"/docs/install/docker"}}');var s=o(4848),i=o(8453);const l={id:"dockercompose",title:"Docker Compose"},a=void 0,t={},c=[{value:"First",id:"first",level:2},{value:"Installation",id:"installation",level:2},{value:"Using Environment Variables",id:"using-environment-variables",level:3},{value:"Prometheus Example",id:"prometheus-example",level:4},{value:"Using Configuration File",id:"using-configuration-file",level:3},{value:"InfluxDB Example",id:"influxdb-example",level:4},{value:"Starting",id:"starting",level:2},{value:"Next Steps",id:"next-steps",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",h4:"h4",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components},{Details:o}=n;return o||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(n.p,{children:["This page assumes that you have decided to start Unpoller using ",(0,s.jsx)(n.code,{children:"docker-compose"}),".\nThe setup detailed below will install containers for Unpoller, Grafana and InfluxDB"]}),"\n",(0,s.jsx)(n.h2,{id:"first",children:"First"}),"\n",(0,s.jsxs)(n.p,{children:["Make sure you have ",(0,s.jsx)(n.a,{href:"controllerlogin",children:"set up a user"})," on your controller for Unpoller."]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"installation",children:"Installation"}),"\n",(0,s.jsx)(n.p,{children:"Unpoller's Docker container can be configured in two ways:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Using environment variables."}),"\n",(0,s.jsx)(n.li,{children:"Using a configuration file."}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Which to use is a matter of personal choice. The environmental path has the advantage that\nall settings are in one place (albeit a hidden file, and one where all information is available\nto all containers). The config file method has the advantage that Unpoller specific\nsettings can be saved in the same shared Docker folder as the rest of the app's data."}),"\n",(0,s.jsxs)(n.p,{children:["There is a detailed description of the configuration parameters on the\n",(0,s.jsx)(n.a,{href:"../install/configuration",children:"Application Configuration"})," page."]}),"\n",(0,s.jsx)(n.p,{children:"Both of the alternatives described here will pull containers not just for Unpoller,\nbut also for InfluxDB and Grafana. If you wish to use existing instances then amend the files as necessary."}),"\n",(0,s.jsx)(n.h3,{id:"using-environment-variables",children:"Using Environment Variables"}),"\n",(0,s.jsxs)(n.p,{children:["The easiest way to pass environment variables via ",(0,s.jsx)(n.code,{children:"docker-compose"})," is to have a\nfile called ",(0,s.jsx)(n.code,{children:".env"})," in the same folder as the ",(0,s.jsx)(n.code,{children:"docker-compose"})," yaml file"]}),"\n",(0,s.jsx)(n.admonition,{title:"Hidden Files",type:"tip",children:(0,s.jsxs)(n.p,{children:["Files beginning with a period ",(0,s.jsx)(n.code,{children:"."})," are generally hidden. You may need to use ",(0,s.jsx)(n.code,{children:"ls -a"})," to find the ",(0,s.jsx)(n.code,{children:".env"})," file."]})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Copy the example ",(0,s.jsx)(n.a,{href:"https://github.com/unpoller/unpoller/blob/master/init/docker/docker-compose.env.example",children:"environment file"})]}),"\n",(0,s.jsxs)(n.li,{children:["Edit it as necessary (in particular ensure that ",(0,s.jsx)(n.code,{children:"UNIFI_USER"})," and ",(0,s.jsx)(n.code,{children:"UNIFI_PASS"})," are set)"]}),"\n",(0,s.jsxs)(n.li,{children:["Save it as ",(0,s.jsx)(n.code,{children:".env"})," in the same folder as your ",(0,s.jsx)(n.code,{children:"docker-compose.yml"})," (if you have one; if not see below)"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["Download the ",(0,s.jsx)(n.a,{href:"https://github.com/unpoller/unpoller/blob/master/init/docker/docker-compose.yml",children:"example"}),"\n",(0,s.jsx)(n.code,{children:"docker-compose.yml"})," and add it to your existing one (if you have one; if not just make sure it is\nsaved in the same folder as the ",(0,s.jsx)(n.code,{children:".env"})," file)"]}),"\n",(0,s.jsx)(n.h4,{id:"prometheus-example",children:"Prometheus Example"}),"\n",(0,s.jsx)(n.p,{children:"This example is advanced, for demonstration only, and not recommend for newbies."}),"\n",(0,s.jsxs)(o,{children:[(0,s.jsx)("summary",{children:"Advanced Prometheus Example"}),(0,s.jsx)(n.hr,{}),(0,s.jsxs)(n.p,{children:["The following example illustrates launching Grafana, Prometheus and Unpoller with docker compose.\nThis does not utilize a ",(0,s.jsx)(n.code,{children:".env"})," file nor a configuration file and instead puts all the env variables\ndirectly into the docker-compose file.\nThis still requires a ",(0,s.jsx)(n.a,{href:"../dependencies/prometheus",children:"Prometheus configuration"})," to scrape Poller."]}),(0,s.jsx)(n.admonition,{type:"note",children:(0,s.jsxs)(n.p,{children:["This is a ",(0,s.jsx)(n.a,{href:"https://github.com/unpoller/unpoller/issues/309#issuecomment-796870916",children:"community provided"}),"\nexample."]})}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:'version: \'3\'\nservices:\n  prometheus:\n    image: prom/prometheus:latest\n    restart: unless-stopped\n    ports:\n      - \'9090:9090\'\n    volumes:\n      - /root/prometheus:/etc/prometheus\n      - prometheus-data:/prometheus\n  grafana:\n    image: grafana/grafana:latest\n    restart: unless-stopped\n    ports:\n      - \'3000:3000\'\n    volumes:\n      - grafana-storage:/var/lib/grafana\n    depends_on:\n      - prometheus\n    environment:\n      - GF_SECURITY_ADMIN_USER=admin\n      - GF_SECURITY_ADMIN_PASSWORD=admin123\n      - GF_INSTALL_PLUGINS=grafana-clock-panel,natel-discrete-panel,grafana-piechart-panel\n  unpoller:\n    image: ghcr.io/unpoller/unpoller:latest\n    restart: unless-stopped\n    ports:\n      - \'9130:9130\'\n    container_name: unpoller\n    environment:\n      UP_INFLUXDB_DISABLE="true"\n      UP_POLLER_DEBUG="false"\n      UP_UNIFI_DYNAMIC="false"\n      UP_PROMETHEUS_HTTP_LISTEN=0.0.0.0:9130\n      UP_PROMETHEUS_NAMESPACE=unpoller\n      UP_UNIFI_CONTROLLER_0_PASS=unpoller12345\n      UP_UNIFI_CONTROLLER_0_SAVE_ALARMS="true"\n      UP_UNIFI_CONTROLLER_0_SAVE_ANOMALIES="true"\n      UP_UNIFI_CONTROLLER_0_SAVE_DPI="true"\n      UP_UNIFI_CONTROLLER_0_SAVE_EVENTS="true"\n      UP_UNIFI_CONTROLLER_0_SAVE_IDS="true"\n      UP_UNIFI_CONTROLLER_0_SAVE_SITES="true"\n      UP_UNIFI_CONTROLLER_0_URL=https://192.168.14.250:8443\n      UP_UNIFI_CONTROLLER_0_USER=unpoller\n\nvolumes:\n  grafana-storage:\n  prometheus-data:\n'})})]}),"\n",(0,s.jsx)(n.h3,{id:"using-configuration-file",children:"Using Configuration File"}),"\n",(0,s.jsx)(n.p,{children:"Alternatively, if you choose to use a configuration file:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Copy the example ",(0,s.jsx)(n.a,{href:"https://github.com/unpoller/unpoller/blob/master/examples/up.conf.example",children:"config file"})]}),"\n",(0,s.jsxs)(n.li,{children:["Edit it as necessary (in particular ensure that the ",(0,s.jsx)(n.code,{children:"[unifi]"}),"/",(0,s.jsx)(n.code,{children:"user"})," and ",(0,s.jsx)(n.code,{children:"pass"})," variables are set)"]}),"\n",(0,s.jsxs)(n.li,{children:["In the ",(0,s.jsx)(n.code,{children:"[influxdb]"})," section change ",(0,s.jsx)(n.code,{children:'url  = "http://127.0.0.1:8086"'})," to become\n",(0,s.jsx)(n.code,{children:'url  = "http://THE_IP_OF_YOUR_DOCKER_HOST:8086"'})]}),"\n",(0,s.jsxs)(n.li,{children:["Save it as ",(0,s.jsx)(n.code,{children:"unpoller.conf"})," in the local location you use for Docker storage in a\nfolder called ",(0,s.jsx)(n.code,{children:"unpoller"})]}),"\n"]}),"\n",(0,s.jsx)(n.admonition,{type:"important",children:(0,s.jsxs)(n.p,{children:["When configuring make sure that you do ",(0,s.jsx)(n.strong,{children:"not"})," include ",(0,s.jsx)(n.code,{children:":8443"})," on the url of the controller\nif you are using ",(0,s.jsx)(n.code,{children:"unifios"}),". Those are: UDM Pro, UDM, UXG, or CloudKey with recent firmware."]})}),"\n",(0,s.jsxs)(n.p,{children:["Add the following to your ",(0,s.jsx)(n.code,{children:"docker-compose.yml"})," after replacing ",(0,s.jsx)(n.code,{children:"YOURLOCALPATH"}),"\nto a local location for Docker storage."]}),"\n",(0,s.jsx)(n.h4,{id:"influxdb-example",children:"InfluxDB Example"}),"\n",(0,s.jsxs)(n.p,{children:["Create this environment file ",(0,s.jsx)(n.code,{children:"docker-compose.env"})," and reference this with ",(0,s.jsx)(n.code,{children:"-e /your/path/docker-compose.env"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-text",children:"#influxdb\nINFLUXDB_HTTP_AUTH_ENABLED=true\nINFLUXDB_ADMIN_USER=unpoller\nINFLUXDB_ADMIN_PASSWORD=CHANGEME\nINFLUXDB_DB=unpoller\nINFLUXDB_ORG=unpoller\nINFLUXDB_BUCKET=unpoller\nINFLUXDB_ADMIN_TOKEN=unpollersecret\n\n#grafana\nGRAFANA_USERNAME=admin\nGRAFANA_PASSWORD=grafanaadmin\n\n#unifi-poller\nPOLLER_TAG=latest\nPOLLER_DEBUG=false\nPOLLER_SAVE_DPI=false\nUNIFI_USER=unpoller\nUNIFI_PASS=set_this_on_your_controller\nUNIFI_URL=https://127.0.0.1:8443\n"})}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"docker-compose.yml"})," file:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"# This is for unifi-poller v2.\nversion: '3'\nservices:\n  influxdb:\n    restart: always\n    image: influxdb:1.8\n    ports:\n      - '8086:8086'\n    volumes:\n      - influxdb-storage:/var/lib/influxdb\n    environment:\n      - INFLUXDB_DB=${INFLUXDB_DB}\n      - INFLUXDB_HTTP_AUTH_ENABLED=${INFLUXDB_HTTP_AUTH_ENABLED}\n      - DOCKER_INFLUXDB_INIT_MODE=setup\n      - DOCKER_INFLUXDB_INIT_USERNAME=${INFLUXDB_ADMIN_USER}\n      - DOCKER_INFLUXDB_INIT_PASSWORD=${INFLUXDB_ADMIN_PASSWORD}\n      - DOCKER_INFLUXDB_INIT_ORG=${INFLUXDB_ORG}\n      - DOCKER_INFLUXDB_INIT_BUCKET=${INFLUXDB_BUCKET}\n      - DOCKER_INFLUXDB_INIT_ADMIN_TOKEN=${INFLUXDB_ADMIN_TOKEN}\n  chronograf:\n    image: chronograf:latest\n    restart: always\n    ports:\n      - '8888:8888'\n    volumes:\n      - chronograf-storage:/var/lib/chronograf\n    depends_on:\n      - influxdb\n    environment:\n      - INFLUXDB_URL=http://influxdb:8086\n      - INFLUXDB_USERNAME=${INFLUXDB_ADMIN_USER}\n      - INFLUXDB_PASSWORD=${INFLUXDB_ADMIN_PASSWORD}\n  grafana:\n    image: grafana/grafana:latest\n    restart: always\n    ports:\n      - '3000:3000'\n    volumes:\n      - grafana-storage:/var/lib/grafana\n    depends_on:\n      - influxdb\n    environment:\n      - GF_SECURITY_ADMIN_USER=${GRAFANA_USERNAME}\n      - GF_SECURITY_ADMIN_PASSWORD=${GRAFANA_PASSWORD}\n      - GF_INSTALL_PLUGINS=grafana-clock-panel,natel-discrete-panel,grafana-piechart-panel\n  unpoller:\n    restart: always\n    image: ghcr.io/unpoller/unpoller:${POLLER_TAG}\n    depends_on:\n      - grafana\n      - influxdb\n      - chronograf\n    environment:\n      - UP_INFLUXDB_DB=${INFLUXDB_DB}\n      - UP_INFLUXDB_USER=${INFLUXDB_ADMIN_USER}\n      - UP_INFLUXDB_PASS=${INFLUXDB_ADMIN_PASSWORD}\n      - UP_INFLUXDB_ORG=${INFLUXDB_ORG}\n      - UP_INFLUXDB_BUCKET=${INFLUXDB_BUCKET}\n      - UP_INFLUXDB_AUTH_TOKEN=${INFLUXDB_ADMIN_TOKEN}\n      - UP_INFLUXDB_URL=http://influxdb:8086\n      - UP_UNIFI_DEFAULT_USER=${UNIFI_USER}\n      - UP_UNIFI_DEFAULT_PASS=${UNIFI_PASS}\n      - UP_UNIFI_DEFAULT_URL=${UNIFI_URL}\n      - UP_POLLER_DEBUG=${POLLER_DEBUG}\n      - UP_UNIFI_DEFAULT_SAVE_DPI=${POLLER_SAVE_DPI}\n    volumes:\n      - YOURPATH/up.conf:/etc/unpoller/up.conf\nvolumes:\n  influxdb-storage:\n  chronograf-storage:\n  grafana-storage:\n"})}),"\n",(0,s.jsx)(n.admonition,{type:"info",children:(0,s.jsxs)(n.p,{children:["Details of tags available are described in ",(0,s.jsx)(n.a,{href:"../help/docker_faq",children:"Docker - FAQ"}),"."]})}),"\n",(0,s.jsx)(n.h2,{id:"starting",children:"Starting"}),"\n",(0,s.jsx)(n.p,{children:"Whichever configuration method you chose, this is how you start the contianers:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"docker-compose up -e docker-compose.env\n"})}),"\n",(0,s.jsx)(n.p,{children:"If everything is working, after a few minutes you should see like likes this:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-none",children:"[INFO] UniFi Metrics Recorded. Sites: 1, Clients: 67, UAP: 6, USG/UDM: 1, USW: 5, IDS Events: 0, Points: 1837, Fields: 11307, Errs: 0, Elapsed: 599ms\n"})}),"\n",(0,s.jsx)(n.p,{children:"If you don't see these lines then look for errors and double-check your work."}),"\n",(0,s.jsx)(n.admonition,{type:"tip",children:(0,s.jsxs)(n.p,{children:["You can see the logs for a container with ",(0,s.jsx)(n.code,{children:"docker logs container-id"}),".\nGet the container id with ",(0,s.jsx)(n.code,{children:"docker ps"}),"."]})}),"\n",(0,s.jsx)(n.p,{children:"Stop the containers and restart them in daemon mode, like this:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"docker-compose up -e docker-compose.env -d\n"})}),"\n",(0,s.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["Creating an InfluxDB database and retention policy is explained on the\n",(0,s.jsx)(n.a,{href:"../dependencies/influxdb#post-setup",children:"InfluxDB"})," page."]}),"\n",(0,s.jsxs)(n.li,{children:["Finish ",(0,s.jsx)(n.a,{href:"../install/grafana",children:"Setting-up Grafana"}),"."]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}}}]);