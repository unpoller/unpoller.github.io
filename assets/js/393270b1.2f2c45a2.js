"use strict";(self.webpackChunkpollerdox=self.webpackChunkpollerdox||[]).push([[634],{1036:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>s,contentTitle:()=>a,default:()=>h,frontMatter:()=>l,metadata:()=>i,toc:()=>p});var o=r(8168),t=(r(6540),r(5680));const l={id:"prometheus",title:"Prometheus"},a=void 0,i={unversionedId:"dependencies/prometheus",id:"dependencies/prometheus",title:"Prometheus",description:"This page explains how to configure Prometheus and Unpoller.",source:"@site/docs/dependencies/prometheus.md",sourceDirName:"dependencies",slug:"/dependencies/prometheus",permalink:"/docs/dependencies/prometheus",draft:!1,tags:[],version:"current",frontMatter:{id:"prometheus",title:"Prometheus"},sidebar:"someSidebar",previous:{title:"Grafana",permalink:"/docs/dependencies/grafana"},next:{title:"Loki",permalink:"/docs/dependencies/loki"}},s={},p=[{value:"Single Controller",id:"single-controller",level:2},{value:"Multiple Controllers",id:"multiple-controllers",level:2},{value:"First Approach",id:"first-approach",level:3},{value:"Second Approach",id:"second-approach",level:3},{value:"Prometheus Configuration for URLs",id:"prometheus-configuration-for-urls",level:4},{value:"Final Approach, NOT Recommended",id:"final-approach-not-recommended",level:3}],u={toc:p},c="wrapper";function h(e){let{components:n,...r}=e;return(0,t.yg)(c,(0,o.A)({},u,r,{components:n,mdxType:"MDXLayout"}),(0,t.yg)("p",null,"This page explains how to configure Prometheus and Unpoller.\nFor help installing Prometheus you'll have to look elsewhere; that's not in this document.\nIf you need help getting started,\n",(0,t.yg)("a",{parentName:"p",href:"../dependencies/influxdb"},"InfluxDB")," is recommended."),(0,t.yg)("admonition",{type:"note"},(0,t.yg)("p",{parentName:"admonition"},"Prometheus support was added in the 1.6 release, but was not very well documented.\nRelease 2.0 brings with it a re-write of the prometheus integration.\nMany changes were made to how one may configure a controller. This page only applies to version 2.0.1+.")),(0,t.yg)("hr",null),(0,t.yg)("h2",{id:"single-controller"},"Single Controller"),(0,t.yg)("p",null,"Configure a single controller in ",(0,t.yg)("inlineCode",{parentName:"p"},"up.conf")," (or using environment variables).\nSee ",(0,t.yg)("a",{parentName:"p",href:"../install/configuration"},"Application Configuration")," and the\n",(0,t.yg)("a",{parentName:"p",href:"https://github.com/unpoller/unpoller/blob/master/examples/up.conf.example"},"example config file"),"\nfor help with that."),(0,t.yg)("p",null,"Then you simply point prometheus at unpoller using a config like this:"),(0,t.yg)("pre",null,(0,t.yg)("code",{parentName:"pre",className:"language-yaml"},"scrape_configs:\n  - job_name: 'unifipoller'\n    scrape_interval: 30s\n    static_configs:\n    - targets: ['localhost:9130']\n")),(0,t.yg)("p",null,"If you have other scrape configs, leave them there. Just add a new one for ",(0,t.yg)("inlineCode",{parentName:"p"},"unifipoller"),".\nReplace localhost with the IP of the host running Poller.\nThat's it! Restart Prometheus and it should begin to scrape data from your controller through Poller."),(0,t.yg)("admonition",{type:"important"},(0,t.yg)("p",{parentName:"admonition"},"UniFi Poller needs to be accessible on TCP port 9130.\nThis may require exposing ports or modifying firewalls.")),(0,t.yg)("h2",{id:"multiple-controllers"},"Multiple Controllers"),(0,t.yg)("p",null,"You can either configure the controllers in unpoller or poll them unconfigured.\nWhen polling unconfigured, you must enable dynamic.\nYou can scrape multiple controllers in several ways. Here is a list of options:"),(0,t.yg)("ol",null,(0,t.yg)("li",{parentName:"ol"},"Set all controller user/passwords the same and pass in controller URLs from Prometheus.\nTo do this, you set the username and password as the default in the unifi config."),(0,t.yg)("li",{parentName:"ol"},"Configure each controller in unpoller and pass in urls from Prometheus.\nThis allows them to have different usernames and passwords."),(0,t.yg)("li",{parentName:"ol"},(0,t.yg)("strong",{parentName:"li"},"NOT Recommended:")," Configure each controller in unpoller and configure\nprometheus as shown above in the Single Controller section. This is useful when you\nwant to poll all the controllers at the same time from a single prometheus instance.")),(0,t.yg)("h3",{id:"first-approach"},"First Approach"),(0,t.yg)("p",null,"This describes approach 1 above."),(0,t.yg)("p",null,"Using this approach all you need to configure for controllers in unpoller is the name\nand password. Example below. Any settings you provide to ","[unifi.defaults]"," will be used\nfor all controllers passed in from Prometheus. All other settings are optional."),(0,t.yg)("pre",null,(0,t.yg)("code",{parentName:"pre",className:"language-toml"},'[unifi]\n  # This must be enabled to do dynamic polls against unconfigured urls.\n  dynamic = true\n[unifi.defaults]\n  user       = "unifipoller"\n  pass       = "unifipoller"\n  sites      = ["all"]\n  save_ids   = false\n  save_dpi   = false\n  save_sites = true\n  verify_ssl = false\n')),(0,t.yg)("p",null,"Or with env variables:"),(0,t.yg)("pre",null,(0,t.yg)("code",{parentName:"pre",className:"language-shell"},'UP_UNIFI_DYNAMIC=true\nUP_UNIFI_DEFAULT_USER="unifipoller"\nUP_UNIFI_DEFAULT_PASS="unifipoller"\n')),(0,t.yg)("h3",{id:"second-approach"},"Second Approach"),(0,t.yg)("p",null,"This describes approach 2 above."),(0,t.yg)("p",null,"Configure each controller in up.conf or using environment variables.\nWhen Prometheus scrapes from unpoller the poller will map the URL directly to the one configured\nin up.conf (or using env vars). Just make sure the url you put into the prometheus configuration\nmatches the url put into the poller configuration."),(0,t.yg)("p",null,"Example polling two controllers:"),(0,t.yg)("pre",null,(0,t.yg)("code",{parentName:"pre",className:"language-toml"},'[unifi]\n  # Not needed since not dynamic.\n  dynamic = false\n[[unifi.controller]]\n  url = "http://unifi.controller:8443"\n  user = "unifipoller1"\n  pass = "unifipoller1"\n[[unifi.controller]]\n  url = "http://another.controller:8443"\n  user = "unifipoller2"\n  pass = "unifipoller2"\n')),(0,t.yg)("p",null,"Or with env variables:"),(0,t.yg)("pre",null,(0,t.yg)("code",{parentName:"pre"},'UP_UNIFI_DYNAMIC=false\nUP_UNIFI_CONTROLLER_0_URL="http://unifi.controller:8443"\nUP_UNIFI_CONTROLLER_0_USER="unifipoller"\nUP_UNIFI_CONTROLLER_0_PASS="unifipoller"\nUP_UNIFI_CONTROLLER_1_URL="http://another.controller:8443"\nUP_UNIFI_CONTROLLER_1_USER="unifipoller"\nUP_UNIFI_CONTROLLER_1_PASS="unifipoller"\n')),(0,t.yg)("h4",{id:"prometheus-configuration-for-urls"},"Prometheus Configuration for URLs"),(0,t.yg)("p",null,"This applies to both approaches above. Configure prometheus like this:"),(0,t.yg)("pre",null,(0,t.yg)("code",{parentName:"pre",className:"language-yaml"},"scrape_configs:\n  - job_name: 'unifipoller'\n    scrape_interval: 30s\n    static_configs:\n      - targets:\n        - https://unifi.controller:8443\n        - https://another.controller:8443\n    metrics_path: /scrape\n    relabel_configs:\n     - source_labels: [__address__]\n       target_label: __param_target\n     - source_labels: [__param_target]\n       target_label: instance\n     - target_label: __address__\n       replacement: localhost:9130\n")),(0,t.yg)("p",null,"Replace ",(0,t.yg)("inlineCode",{parentName:"p"},"localhost")," with the IP of your unpoller host, and replace ",(0,t.yg)("inlineCode",{parentName:"p"},"unifi.controller"),"\nand another.controller with the IPs of your controllers."),(0,t.yg)("h3",{id:"final-approach-not-recommended"},"Final Approach, NOT Recommended"),(0,t.yg)("p",null,"Just configure your controllers in ",(0,t.yg)("inlineCode",{parentName:"p"},"up.conf")," or using env variables as explained in the\n",(0,t.yg)("a",{parentName:"p",href:"../install/configuration"},"Application Configuration")," page. Then setup Prometheus like this:"),(0,t.yg)("pre",null,(0,t.yg)("code",{parentName:"pre",className:"language-yaml"},"scrape_configs:\n  - job_name: 'unifipoller'\n    scrape_interval: 30s\n    static_configs:\n    - targets: ['localhost:9130']\n")),(0,t.yg)("p",null,"The standard ",(0,t.yg)("inlineCode",{parentName:"p"},"/metrics")," path that the above snippet uses returns metrics for all configured controllers."))}h.isMDXComponent=!0},5680:(e,n,r)=>{r.d(n,{xA:()=>u,yg:()=>m});var o=r(6540);function t(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function l(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),r.push.apply(r,o)}return r}function a(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?l(Object(r),!0).forEach((function(n){t(e,n,r[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):l(Object(r)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))}))}return e}function i(e,n){if(null==e)return{};var r,o,t=function(e,n){if(null==e)return{};var r,o,t={},l=Object.keys(e);for(o=0;o<l.length;o++)r=l[o],n.indexOf(r)>=0||(t[r]=e[r]);return t}(e,n);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(o=0;o<l.length;o++)r=l[o],n.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(t[r]=e[r])}return t}var s=o.createContext({}),p=function(e){var n=o.useContext(s),r=n;return e&&(r="function"==typeof e?e(n):a(a({},n),e)),r},u=function(e){var n=p(e.components);return o.createElement(s.Provider,{value:n},e.children)},c="mdxType",h={inlineCode:"code",wrapper:function(e){var n=e.children;return o.createElement(o.Fragment,{},n)}},g=o.forwardRef((function(e,n){var r=e.components,t=e.mdxType,l=e.originalType,s=e.parentName,u=i(e,["components","mdxType","originalType","parentName"]),c=p(r),g=t,m=c["".concat(s,".").concat(g)]||c[g]||h[g]||l;return r?o.createElement(m,a(a({ref:n},u),{},{components:r})):o.createElement(m,a({ref:n},u))}));function m(e,n){var r=arguments,t=n&&n.mdxType;if("string"==typeof e||t){var l=r.length,a=new Array(l);a[0]=g;var i={};for(var s in n)hasOwnProperty.call(n,s)&&(i[s]=n[s]);i.originalType=e,i[c]="string"==typeof e?e:t,a[1]=i;for(var p=2;p<l;p++)a[p]=r[p];return o.createElement.apply(null,a)}return o.createElement.apply(null,r)}g.displayName="MDXCreateElement"}}]);