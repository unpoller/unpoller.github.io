"use strict";(self.webpackChunkpollerdox=self.webpackChunkpollerdox||[]).push([[162],{4422:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>r,default:()=>u,frontMatter:()=>a,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"dependencies/loki","title":"Loki","description":"Poller optionally provides support for writing UniFi\'s Events, Anomalies, Alarms and IDS data to Loki.","source":"@site/docs/dependencies/loki.md","sourceDirName":"dependencies","slug":"/dependencies/loki","permalink":"/docs/dependencies/loki","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"id":"loki","title":"Loki"},"sidebar":"someSidebar","previous":{"title":"Prometheus","permalink":"/docs/dependencies/prometheus"},"next":{"title":"InfluxDB","permalink":"/docs/dependencies/influxdb"}}');var o=t(4848),i=t(8453);const a={id:"loki",title:"Loki"},r=void 0,l={},d=[{value:"Installation",id:"installation",level:2},{value:"Usage",id:"usage",level:2},{value:"Advanced",id:"advanced",level:2},{value:"Examples",id:"examples",level:2}];function c(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",hr:"hr",p:"p",pre:"pre",strong:"strong",...(0,i.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.p,{children:"Poller optionally provides support for writing UniFi's Events, Anomalies, Alarms and IDS data to Loki.\nThere are no dashboards for this data, but it's pretty simple. Just add a \"Logs\" panel.\nYou can also use this data as an Annotation source."}),"\n",(0,o.jsx)(n.admonition,{type:"note",children:(0,o.jsx)(n.p,{children:"Loki support was added in UniFi Poller v2.0.2."})}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h2,{id:"installation",children:"Installation"}),"\n",(0,o.jsxs)(n.p,{children:["Installation of Loki is documented ",(0,o.jsx)(n.a,{href:"https://grafana.com/docs/loki/latest/installation/",children:"here"}),".\nIf you're only using Poller, you don't need Promtail."]}),"\n",(0,o.jsx)(n.h2,{id:"usage",children:"Usage"}),"\n",(0,o.jsx)(n.p,{children:"Just add the Loki URL to your poller config to enable this output plugin."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-toml",children:'[loki]\n  url = "http://127.0.0.1:3100"\n'})}),"\n",(0,o.jsx)(n.p,{children:"Use the UniFi input plugin settings to choose which logs to collect and save. Example:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-toml",children:"[unifi.defaults]\n  save_ids       = true\n  save_events    = true\n  save_alarms    = true\n  save_anomalies = true\n"})}),"\n",(0,o.jsx)(n.admonition,{type:"important",children:(0,o.jsxs)(n.p,{children:["Loki must be added as a data source to Grafana, and panels or annotations should be created with that data.\nGrafana Labs documents ",(0,o.jsx)(n.strong,{children:(0,o.jsx)(n.a,{href:"https://grafana.com/docs/grafana/latest/datasources/loki/",children:"Loki with Grafana usage"})}),".\nHere's a ",(0,o.jsx)(n.strong,{children:(0,o.jsx)(n.a,{href:"https://grafana.com/blog/2020/04/08/loki-quick-tip-how-to-create-a-grafana-dashboard-for-searching-logs-using-loki-and-prometheus/",children:"bonus blog post"})}),"\nabout using Loki with Grafana."]})}),"\n",(0,o.jsx)(n.h2,{id:"advanced",children:"Advanced"}),"\n",(0,o.jsx)(n.p,{children:"The Loki output plugin has a few advanced settings that most folks won't use. These are their default values."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-toml",children:'user       = ""\npass       = ""\nverify_ssl = false\ntenant_id  = ""\ninterval   = "2m"\ntimeout    = "10s"\n'})}),"\n",(0,o.jsxs)(n.p,{children:["You can set a user and pass if your Loki instance requires auth. This currently only supports Basic Auth.\nPlease open an ",(0,o.jsx)(n.a,{href:"https://github.com/unpoller/unpoller/issues/",children:"Issue"})," if you need support for something\nelse. Alternatively you can pass the Tenant ID header directly by setting ",(0,o.jsx)(n.code,{children:"tenant_id"}),".\nIf your Loki instance is using/behind an SSL proxy that has a valid SSL cert you may set ",(0,o.jsx)(n.code,{children:"verify_ssl"})," to true.\nThe recommended interval is ",(0,o.jsx)(n.code,{children:"2m"})," but anything from ",(0,o.jsx)(n.code,{children:"1m"})," to ",(0,o.jsx)(n.code,{children:"15m"})," should work fine.\nThe timeout is ",(0,o.jsx)(n.code,{children:"10s"}),", adjust it if you get timeout errors."]}),"\n",(0,o.jsx)(n.h2,{id:"examples",children:"Examples"}),"\n",(0,o.jsxs)(n.p,{children:["The ",(0,o.jsx)(n.code,{children:"docker-compose"})," example below (using Loki and Prometheus) was kindly provided by a community member.\nThe Loki Docker logging driver if you don't have it installed."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:'version: \'3.0\'\nservices:\n  unpoller:\n    container_name: unpoller\n    environment:\n      UP_INFLUXDB_DISABLE: "true"\n      UP_LOKI_DISABLE: "false"\n      UP_LOKI_URL: http://log01.tylephony.com:3100\n      UP_POLLER_DEBUG: "false"\n      UP_PROMETHEUS_HTTP_LISTEN: 0.0.0.0:9130\n      UP_PROMETHEUS_NAMESPACE: unifipoller\n      UP_UNIFI_DEFAULT_PASS: password\n      UP_UNIFI_DEFAULT_SAVE_ALARMS: "true"\n      UP_UNIFI_DEFAULT_SAVE_ANOMALIES: "true"\n      UP_UNIFI_DEFAULT_SAVE_DPI: "true"\n      UP_UNIFI_DEFAULT_SAVE_EVENTS: "true"\n      UP_UNIFI_DEFAULT_SAVE_IDS: "true"\n      UP_UNIFI_DEFAULT_SAVE_SITES: "true"\n      UP_UNIFI_DEFAULT_URL: https://unifi.tylephony.com:443\n      UP_UNIFI_DEFAULT_USER: unifipoller\n    image: ghcr.io/unpoller/unpoller:latest\n    logging:\n      driver: loki\n      options:\n        loki-url: http://log01.tylephony.com:3100/loki/api/v1/push\n    ports:\n    - 9130:9130/tcp\n    restart: always\n'})}),"\n",(0,o.jsx)(n.admonition,{type:"note",children:(0,o.jsx)(n.p,{children:"The above is a community-provided example."})})]})}function u(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(c,{...e})}):c(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>a,x:()=>r});var s=t(6540);const o={},i=s.createContext(o);function a(e){const n=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:a(e.components),s.createElement(i.Provider,{value:n},e.children)}}}]);